<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Alien Attack Avoidance</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background-color: black;
    }
    canvas {
      display: block;
    }
  </style>
</head>
<body>
  <canvas id="gameCanvas"></canvas>
  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    const SCREEN_WIDTH = canvas.width;
    const SCREEN_HEIGHT = canvas.height;

    const colors = {
      WHITE: "#FFFFFF",
      BLACK: "#000000",
      RED: "#FF0000",
      BLUE: "#0000FF",
      GREEN: "#00FF00",
      YELLOW: "#FFFF00",
      PURPLE: "#800080"
    };

    const player = {
      width: 50,
      height: 50,
      x: SCREEN_WIDTH / 2 - 25,
      y: SCREEN_HEIGHT - 70,
      speed: 15,
      dx: 0,
      color: colors.BLUE
    };

    const aliens = [
      { x: SCREEN_WIDTH / 4 - 50, y: 50, speed: 3, direction: 1, lasers: [], color: colors.GREEN },
      { x: SCREEN_WIDTH / 2 - 50, y: 50, speed: 4, direction: -1, lasers: [], color: colors.YELLOW },
      { x: (3 * SCREEN_WIDTH) / 4 - 50, y: 50, speed: 5, direction: 1, lasers: [], color: colors.PURPLE }
    ];

    const laserTemplate = {
      width: 10,
      height: 30,
      speed: 10,
      color: colors.RED // All lasers are now red
    };

    let score = 0;
    let gameOver = false;
    let quitGame = false;

    function drawPlayer() {
      ctx.fillStyle = player.color;
      ctx.fillRect(player.x, player.y, player.width, player.height);
    }

    function drawAlien(alien) {
      ctx.fillStyle = alien.color;
      ctx.beginPath();
      ctx.ellipse(alien.x + 50, alien.y + 25, 50, 25, 0, 0, Math.PI * 2);
      ctx.fill();
      ctx.fillStyle = colors.WHITE;
      ctx.fillRect(alien.x + 20, alien.y + 45, 60, 10);
    }

    function drawLaser(laser) {
      ctx.fillStyle = laserTemplate.color; // Use red for all lasers
      ctx.fillRect(laser.x, laser.y, laserTemplate.width, laserTemplate.height);
    }

    function drawScore() {
      ctx.fillStyle = colors.WHITE;
      ctx.font = "24px Arial";
      ctx.fillText(`Score: ${score}`, 20, 40);
    }

    function drawQuitScreen() {
      ctx.fillStyle = colors.BLACK;
      ctx.fillRect(0, 0, SCREEN_WIDTH, SCREEN_HEIGHT);
      ctx.fillStyle = colors.WHITE;
      ctx.font = "36px Arial";
      ctx.fillText("You quit the game. Refresh to restart.", SCREEN_WIDTH / 2 - 200, SCREEN_HEIGHT / 2);
    }

    function updatePlayerPosition() {
      player.x += player.dx;

      // Prevent player from moving off-screen
      if (player.x < 0) player.x = 0;
      if (player.x > SCREEN_WIDTH - player.width) player.x = SCREEN_WIDTH - player.width;
    }

    function update() {
      if (gameOver || quitGame) return;

      updatePlayerPosition();

      aliens.forEach((alien) => {
        alien.x += alien.speed * alien.direction;

        // Reverse direction on canvas edge
        if (alien.x <= 0 || alien.x >= SCREEN_WIDTH - 100) {
          alien.direction *= -1;
        }

        // Randomly generate lasers
        if (Math.random() < 0.03) {
          alien.lasers.push({ x: alien.x + 45, y: alien.y + 50 });
        }

        alien.lasers.forEach((laser, index) => {
          laser.y += laserTemplate.speed;

          // Remove lasers if they move off-screen
          if (laser.y > SCREEN_HEIGHT) {
            alien.lasers.splice(index, 1);
            score++;
          } else if (
            laser.x < player.x + player.width &&
            laser.x + laserTemplate.width > player.x &&
            laser.y < player.y + player.height &&
            laser.y + laserTemplate.height > player.y
          ) {
            gameOver = true;
          }
        });
      });
    }

    function draw() {
      if (quitGame) {
        drawQuitScreen();
        return;
      }
      ctx.clearRect(0, 0, SCREEN_WIDTH, SCREEN_HEIGHT);
      drawPlayer();
      aliens.forEach((alien) => {
        drawAlien(alien);
        alien.lasers.forEach(drawLaser);
      });
      drawScore();
    }

    function loop() {
      if (!gameOver && !quitGame) {
        update();
        draw();
        requestAnimationFrame(loop);
      } else if (quitGame) {
        drawQuitScreen();
      } else {
        gameOverScreen();
      }
    }

    window.addEventListener("keydown", (e) => {
      if (!gameOver && !quitGame) {
        if (e.key === "ArrowLeft") {
          player.dx = -player.speed;
        }
        if (e.key === "ArrowRight") {
          player.dx = player.speed;
        }
      } else if (gameOver) {
        if (e.key.toLowerCase() === "r") {
          score = 0;
          aliens.forEach((alien) => (alien.lasers = []));
          player.x = SCREEN_WIDTH / 2 - player.width / 2;
          gameOver = false;
        }
      }
      if (e.key.toLowerCase() === "q") {
        quitGame = true;
      }
    });

    window.addEventListener("keyup", (e) => {
      if (e.key === "ArrowLeft" || e.key === "ArrowRight") {
        player.dx = 0; // Stop player movement when the key is released
      }
    });

    loop();
  </script>
</body>
</html>
